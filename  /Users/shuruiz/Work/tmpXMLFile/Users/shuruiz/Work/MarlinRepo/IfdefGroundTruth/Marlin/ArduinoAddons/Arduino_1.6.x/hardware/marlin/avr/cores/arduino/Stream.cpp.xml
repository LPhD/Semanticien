<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.sdml.info/srcML/src" xmlns:cpp="http://www.sdml.info/srcML/cpp" xmlns:PREFIX="http://www.sdml.info/srcML/position" language="C++" filename=" /Users/shuruiz/Work/tmpXMLFile//Users/shuruiz/Work/MarlinRepo/IfdefGroundTruth/Marlin/ArduinoAddons/Arduino_1.6.x/hardware/marlin/avr/cores/arduino/Stream.cpp" PREFIX:tabs="8"><comment type="block" PREFIX:line="1" PREFIX:column="1">/*
 Stream.cpp - adds parsing methods to Stream class
 Copyright (c) 2008 David A. Mellis.  All right reserved.

 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation; either
 version 2.1 of the License, or (at your option) any later version.

 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public
 License along with this library; if not, write to the Free Software
 Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA

 Created July 2011
 parsing functions based on TextFinder library by Michael Margolis

 findMulti/findUntil routines written by Jim Leonard/Xuth
 */</comment>

<cpp:include PREFIX:line="25" PREFIX:column="1">#<cpp:directive PREFIX:line="25" PREFIX:column="2">include</cpp:directive> <cpp:file PREFIX:line="25" PREFIX:column="10">"Arduino.h"</cpp:file></cpp:include>
<cpp:include PREFIX:line="26" PREFIX:column="1">#<cpp:directive PREFIX:line="26" PREFIX:column="2">include</cpp:directive> <cpp:file PREFIX:line="26" PREFIX:column="10">"Stream.h"</cpp:file></cpp:include>

<cpp:define PREFIX:line="28" PREFIX:column="1">#<cpp:directive PREFIX:line="28" PREFIX:column="2">define</cpp:directive> <cpp:macro><name PREFIX:line="28" PREFIX:column="9">PARSE_TIMEOUT</name></cpp:macro> <cpp:value PREFIX:line="28" PREFIX:column="23">1000</cpp:value></cpp:define>  <comment type="line" PREFIX:line="28" PREFIX:column="29">// default number of milli-seconds to wait</comment>
<cpp:define PREFIX:line="29" PREFIX:column="1">#<cpp:directive PREFIX:line="29" PREFIX:column="2">define</cpp:directive> <cpp:macro><name PREFIX:line="29" PREFIX:column="9">NO_SKIP_CHAR</name></cpp:macro>  <cpp:value PREFIX:line="29" PREFIX:column="23">1</cpp:value></cpp:define>  <comment type="line" PREFIX:line="29" PREFIX:column="26">// a magic char not found in a valid ASCII numeric field</comment>

<comment type="line" PREFIX:line="31" PREFIX:column="1">// private method to read stream with timeout</comment>
<function><type><name PREFIX:line="32" PREFIX:column="1">int</name></type> <name><name PREFIX:line="32" PREFIX:column="5">Stream</name>::<name PREFIX:line="32" PREFIX:column="13">timedRead</name></name><parameter_list PREFIX:line="32" PREFIX:column="22">()</parameter_list>
<block PREFIX:line="33" PREFIX:column="1">{
  <decl_stmt><decl><type><name PREFIX:line="34" PREFIX:column="3">int</name></type> <name PREFIX:line="34" PREFIX:column="7">c</name></decl>;</decl_stmt>
  <expr_stmt><expr><name PREFIX:line="35" PREFIX:column="3">_startMillis</name> = <call><name PREFIX:line="35" PREFIX:column="18">millis</name><argument_list PREFIX:line="35" PREFIX:column="24">()</argument_list></call></expr>;</expr_stmt>
  <do PREFIX:line="36" PREFIX:column="3">do <block PREFIX:line="36" PREFIX:column="6">{
    <expr_stmt><expr><name PREFIX:line="37" PREFIX:column="5">c</name> = <call><name PREFIX:line="37" PREFIX:column="9">read</name><argument_list PREFIX:line="37" PREFIX:column="13">()</argument_list></call></expr>;</expr_stmt>
    <if PREFIX:line="38" PREFIX:column="5">if <condition PREFIX:line="38" PREFIX:column="8">(<expr><name PREFIX:line="38" PREFIX:column="9">c</name> &gt;= 0</expr>)</condition><then PREFIX:line="38" PREFIX:column="16"> <return PREFIX:line="38" PREFIX:column="17">return <expr><name PREFIX:line="38" PREFIX:column="24">c</name></expr>;</return></then></if>
  }</block> while<condition PREFIX:line="39" PREFIX:column="10">(<expr><call><name PREFIX:line="39" PREFIX:column="11">millis</name><argument_list PREFIX:line="39" PREFIX:column="17">()</argument_list></call> - <name PREFIX:line="39" PREFIX:column="22">_startMillis</name> &lt; <name PREFIX:line="39" PREFIX:column="37">_timeout</name></expr>)</condition>;</do>
  <return PREFIX:line="40" PREFIX:column="3">return <expr PREFIX:line="40" PREFIX:column="10">-1</expr>;</return>     <comment type="line" PREFIX:line="40" PREFIX:column="18">// -1 indicates timeout</comment>
}</block></function>

<comment type="line" PREFIX:line="43" PREFIX:column="1">// private method to peek stream with timeout</comment>
<function><type><name PREFIX:line="44" PREFIX:column="1">int</name></type> <name><name PREFIX:line="44" PREFIX:column="5">Stream</name>::<name PREFIX:line="44" PREFIX:column="13">timedPeek</name></name><parameter_list PREFIX:line="44" PREFIX:column="22">()</parameter_list>
<block PREFIX:line="45" PREFIX:column="1">{
  <decl_stmt><decl><type><name PREFIX:line="46" PREFIX:column="3">int</name></type> <name PREFIX:line="46" PREFIX:column="7">c</name></decl>;</decl_stmt>
  <expr_stmt><expr><name PREFIX:line="47" PREFIX:column="3">_startMillis</name> = <call><name PREFIX:line="47" PREFIX:column="18">millis</name><argument_list PREFIX:line="47" PREFIX:column="24">()</argument_list></call></expr>;</expr_stmt>
  <do PREFIX:line="48" PREFIX:column="3">do <block PREFIX:line="48" PREFIX:column="6">{
    <expr_stmt><expr><name PREFIX:line="49" PREFIX:column="5">c</name> = <call><name PREFIX:line="49" PREFIX:column="9">peek</name><argument_list PREFIX:line="49" PREFIX:column="13">()</argument_list></call></expr>;</expr_stmt>
    <if PREFIX:line="50" PREFIX:column="5">if <condition PREFIX:line="50" PREFIX:column="8">(<expr><name PREFIX:line="50" PREFIX:column="9">c</name> &gt;= 0</expr>)</condition><then PREFIX:line="50" PREFIX:column="16"> <return PREFIX:line="50" PREFIX:column="17">return <expr><name PREFIX:line="50" PREFIX:column="24">c</name></expr>;</return></then></if>
  }</block> while<condition PREFIX:line="51" PREFIX:column="10">(<expr><call><name PREFIX:line="51" PREFIX:column="11">millis</name><argument_list PREFIX:line="51" PREFIX:column="17">()</argument_list></call> - <name PREFIX:line="51" PREFIX:column="22">_startMillis</name> &lt; <name PREFIX:line="51" PREFIX:column="37">_timeout</name></expr>)</condition>;</do>
  <return PREFIX:line="52" PREFIX:column="3">return <expr PREFIX:line="52" PREFIX:column="10">-1</expr>;</return>     <comment type="line" PREFIX:line="52" PREFIX:column="18">// -1 indicates timeout</comment>
}</block></function>

<comment type="line" PREFIX:line="55" PREFIX:column="1">// returns peek of the next digit in the stream or -1 if timeout</comment>
<comment type="line" PREFIX:line="56" PREFIX:column="1">// discards non-numeric characters</comment>
<function><type><name PREFIX:line="57" PREFIX:column="1">int</name></type> <name><name PREFIX:line="57" PREFIX:column="5">Stream</name>::<name PREFIX:line="57" PREFIX:column="13">peekNextDigit</name></name><parameter_list PREFIX:line="57" PREFIX:column="26">()</parameter_list>
<block PREFIX:line="58" PREFIX:column="1">{
  <decl_stmt><decl><type><name PREFIX:line="59" PREFIX:column="3">int</name></type> <name PREFIX:line="59" PREFIX:column="7">c</name></decl>;</decl_stmt>
  <while PREFIX:line="60" PREFIX:column="3">while <condition PREFIX:line="60" PREFIX:column="9">(<expr PREFIX:line="60" PREFIX:column="10">1</expr>)</condition> <block PREFIX:line="60" PREFIX:column="13">{
    <expr_stmt><expr><name PREFIX:line="61" PREFIX:column="5">c</name> = <call><name PREFIX:line="61" PREFIX:column="9">timedPeek</name><argument_list PREFIX:line="61" PREFIX:column="18">()</argument_list></call></expr>;</expr_stmt>
    <if PREFIX:line="62" PREFIX:column="5">if <condition PREFIX:line="62" PREFIX:column="8">(<expr><name PREFIX:line="62" PREFIX:column="9">c</name> &lt; 0</expr>)</condition><then PREFIX:line="62" PREFIX:column="15"> <return PREFIX:line="62" PREFIX:column="16">return <expr><name PREFIX:line="62" PREFIX:column="23">c</name></expr>;</return></then></if>  <comment type="line" PREFIX:line="62" PREFIX:column="27">// timeout</comment>
    <if PREFIX:line="63" PREFIX:column="5">if <condition PREFIX:line="63" PREFIX:column="8">(<expr><name PREFIX:line="63" PREFIX:column="9">c</name> == '-'</expr>)</condition><then PREFIX:line="63" PREFIX:column="18"> <return PREFIX:line="63" PREFIX:column="19">return <expr><name PREFIX:line="63" PREFIX:column="26">c</name></expr>;</return></then></if>
    <if PREFIX:line="64" PREFIX:column="5">if <condition PREFIX:line="64" PREFIX:column="8">(<expr><name PREFIX:line="64" PREFIX:column="9">c</name> &gt;= '0' &amp;&amp; <name PREFIX:line="64" PREFIX:column="21">c</name> &lt;= '9'</expr>)</condition><then PREFIX:line="64" PREFIX:column="30"> <return PREFIX:line="64" PREFIX:column="31">return <expr><name PREFIX:line="64" PREFIX:column="38">c</name></expr>;</return></then></if>
    <expr_stmt><expr><call><name PREFIX:line="65" PREFIX:column="5">read</name><argument_list PREFIX:line="65" PREFIX:column="9">()</argument_list></call></expr>;</expr_stmt>  <comment type="line" PREFIX:line="65" PREFIX:column="14">// discard non-numeric</comment>
  }</block></while>
}</block></function>

<comment type="line" PREFIX:line="69" PREFIX:column="1">// Public Methods</comment>
<comment type="line" format="doxygen" PREFIX:line="70" PREFIX:column="1">//////////////////////////////////////////////////////////////</comment>

<function><type><name PREFIX:line="72" PREFIX:column="1">void</name></type> <name><name PREFIX:line="72" PREFIX:column="6">Stream</name>::<name PREFIX:line="72" PREFIX:column="14">setTimeout</name></name><parameter_list PREFIX:line="72" PREFIX:column="24">(<param><decl><type><name PREFIX:line="72" PREFIX:column="25">unknowntype</name> <name PREFIX:line="72" PREFIX:column="37">long</name></type> <name PREFIX:line="72" PREFIX:column="42">timeout</name></decl></param>)</parameter_list>  <comment type="line" PREFIX:line="72" PREFIX:column="52">// sets the maximum number of milliseconds to wait</comment>
<block PREFIX:line="73" PREFIX:column="1">{
  <expr_stmt><expr><name PREFIX:line="74" PREFIX:column="3">_timeout</name> = <name PREFIX:line="74" PREFIX:column="14">timeout</name></expr>;</expr_stmt>
}</block></function>

 <comment type="line" PREFIX:line="77" PREFIX:column="2">// find returns true if the target string is found</comment>
<function><type><name PREFIX:line="78" PREFIX:column="1">bool</name></type>  <name><name PREFIX:line="78" PREFIX:column="7">Stream</name>::<name PREFIX:line="78" PREFIX:column="15">find</name></name><parameter_list PREFIX:line="78" PREFIX:column="19">(<param><decl><type><name PREFIX:line="78" PREFIX:column="20">char</name> *</type><name PREFIX:line="78" PREFIX:column="26">target</name></decl></param>)</parameter_list>
<block PREFIX:line="79" PREFIX:column="1">{
  <return PREFIX:line="80" PREFIX:column="3">return <expr><call><name PREFIX:line="80" PREFIX:column="10">findUntil</name><argument_list PREFIX:line="80" PREFIX:column="19">(<argument><expr><name PREFIX:line="80" PREFIX:column="20">target</name></expr></argument>, <argument><expr><call><name PREFIX:line="80" PREFIX:column="28">strlen</name><argument_list PREFIX:line="80" PREFIX:column="34">(<argument><expr><name PREFIX:line="80" PREFIX:column="35">target</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name PREFIX:line="80" PREFIX:column="44">NULL</name></expr></argument>, <argument><expr PREFIX:line="80" PREFIX:column="50">0</expr></argument>)</argument_list></call></expr>;</return>
}</block></function>

<comment type="line" PREFIX:line="83" PREFIX:column="1">// reads data from the stream until the target string of given length is found</comment>
<comment type="line" PREFIX:line="84" PREFIX:column="1">// returns true if target string is found, false if timed out</comment>
<function><type><name PREFIX:line="85" PREFIX:column="1">bool</name></type> <name><name PREFIX:line="85" PREFIX:column="6">Stream</name>::<name PREFIX:line="85" PREFIX:column="14">find</name></name><parameter_list PREFIX:line="85" PREFIX:column="18">(<param><decl><type><name PREFIX:line="85" PREFIX:column="19">char</name> *</type><name PREFIX:line="85" PREFIX:column="25">target</name></decl></param>, <param><decl><type><name PREFIX:line="85" PREFIX:column="33">size_t</name></type> <name PREFIX:line="85" PREFIX:column="40">length</name></decl></param>)</parameter_list>
<block PREFIX:line="86" PREFIX:column="1">{
  <return PREFIX:line="87" PREFIX:column="3">return <expr><call><name PREFIX:line="87" PREFIX:column="10">findUntil</name><argument_list PREFIX:line="87" PREFIX:column="19">(<argument><expr><name PREFIX:line="87" PREFIX:column="20">target</name></expr></argument>, <argument><expr><name PREFIX:line="87" PREFIX:column="28">length</name></expr></argument>, <argument><expr><name PREFIX:line="87" PREFIX:column="36">NULL</name></expr></argument>, <argument><expr PREFIX:line="87" PREFIX:column="42">0</expr></argument>)</argument_list></call></expr>;</return>
}</block></function>

<comment type="line" PREFIX:line="90" PREFIX:column="1">// as find but search ends if the terminator string is found</comment>
<function><type><name PREFIX:line="91" PREFIX:column="1">bool</name></type>  <name><name PREFIX:line="91" PREFIX:column="7">Stream</name>::<name PREFIX:line="91" PREFIX:column="15">findUntil</name></name><parameter_list PREFIX:line="91" PREFIX:column="24">(<param><decl><type><name PREFIX:line="91" PREFIX:column="25">char</name> *</type><name PREFIX:line="91" PREFIX:column="31">target</name></decl></param>, <param><decl><type><name PREFIX:line="91" PREFIX:column="39">char</name> *</type><name PREFIX:line="91" PREFIX:column="45">terminator</name></decl></param>)</parameter_list>
<block PREFIX:line="92" PREFIX:column="1">{
  <return PREFIX:line="93" PREFIX:column="3">return <expr><call><name PREFIX:line="93" PREFIX:column="10">findUntil</name><argument_list PREFIX:line="93" PREFIX:column="19">(<argument><expr><name PREFIX:line="93" PREFIX:column="20">target</name></expr></argument>, <argument><expr><call><name PREFIX:line="93" PREFIX:column="28">strlen</name><argument_list PREFIX:line="93" PREFIX:column="34">(<argument><expr><name PREFIX:line="93" PREFIX:column="35">target</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name PREFIX:line="93" PREFIX:column="44">terminator</name></expr></argument>, <argument><expr><call><name PREFIX:line="93" PREFIX:column="56">strlen</name><argument_list PREFIX:line="93" PREFIX:column="62">(<argument><expr><name PREFIX:line="93" PREFIX:column="63">terminator</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
}</block></function>

<comment type="line" PREFIX:line="96" PREFIX:column="1">// reads data from the stream until the target string of the given length is found</comment>
<comment type="line" PREFIX:line="97" PREFIX:column="1">// search terminated if the terminator string is found</comment>
<comment type="line" PREFIX:line="98" PREFIX:column="1">// returns true if target string is found, false if terminated or timed out</comment>
<function><type><name PREFIX:line="99" PREFIX:column="1">bool</name></type> <name><name PREFIX:line="99" PREFIX:column="6">Stream</name>::<name PREFIX:line="99" PREFIX:column="14">findUntil</name></name><parameter_list PREFIX:line="99" PREFIX:column="23">(<param><decl><type><name PREFIX:line="99" PREFIX:column="24">char</name> *</type><name PREFIX:line="99" PREFIX:column="30">target</name></decl></param>, <param><decl><type><name PREFIX:line="99" PREFIX:column="38">size_t</name></type> <name PREFIX:line="99" PREFIX:column="45">targetLen</name></decl></param>, <param><decl><type><name PREFIX:line="99" PREFIX:column="56">char</name> *</type><name PREFIX:line="99" PREFIX:column="62">terminator</name></decl></param>, <param><decl><type><name PREFIX:line="99" PREFIX:column="74">size_t</name></type> <name PREFIX:line="99" PREFIX:column="81">termLen</name></decl></param>)</parameter_list>
<block PREFIX:line="100" PREFIX:column="1">{
  <if PREFIX:line="101" PREFIX:column="3">if <condition PREFIX:line="101" PREFIX:column="6">(<expr><name PREFIX:line="101" PREFIX:column="7">terminator</name> == <name PREFIX:line="101" PREFIX:column="21">NULL</name></expr>)</condition><then PREFIX:line="101" PREFIX:column="26"> <block PREFIX:line="101" PREFIX:column="27">{
    <decl_stmt><decl><type><name PREFIX:line="102" PREFIX:column="5">MultiTarget</name></type> <name><name PREFIX:line="102" PREFIX:column="17">t</name><index PREFIX:line="102" PREFIX:column="18">[<expr PREFIX:line="102" PREFIX:column="19">1</expr>]</index></name> <init PREFIX:line="102" PREFIX:column="22">= <expr><block PREFIX:line="102" PREFIX:column="24">{<expr><block PREFIX:line="102" PREFIX:column="25">{<expr><name PREFIX:line="102" PREFIX:column="26">target</name></expr>, <expr><name PREFIX:line="102" PREFIX:column="34">targetLen</name></expr>, <expr PREFIX:line="102" PREFIX:column="45">0</expr>}</block></expr>}</block></expr></init></decl>;</decl_stmt>
    <return PREFIX:line="103" PREFIX:column="5">return <expr><call><name PREFIX:line="103" PREFIX:column="12">findMulti</name><argument_list PREFIX:line="103" PREFIX:column="21">(<argument><expr><name PREFIX:line="103" PREFIX:column="22">t</name></expr></argument>, <argument><expr PREFIX:line="103" PREFIX:column="25">1</expr></argument>)</argument_list></call> == 0 ? true : false</expr>;</return>
  }</block></then> <else PREFIX:line="104" PREFIX:column="5">else <block PREFIX:line="104" PREFIX:column="10">{
    <decl_stmt><decl><type><name PREFIX:line="105" PREFIX:column="5">MultiTarget</name></type> <name><name PREFIX:line="105" PREFIX:column="17">t</name><index PREFIX:line="105" PREFIX:column="18">[<expr PREFIX:line="105" PREFIX:column="19">2</expr>]</index></name> <init PREFIX:line="105" PREFIX:column="22">= <expr><block PREFIX:line="105" PREFIX:column="24">{<expr><block PREFIX:line="105" PREFIX:column="25">{<expr><name PREFIX:line="105" PREFIX:column="26">target</name></expr>, <expr><name PREFIX:line="105" PREFIX:column="34">targetLen</name></expr>, <expr PREFIX:line="105" PREFIX:column="45">0</expr>}</block></expr>, <expr><block PREFIX:line="105" PREFIX:column="49">{<expr><name PREFIX:line="105" PREFIX:column="50">terminator</name></expr>, <expr><name PREFIX:line="105" PREFIX:column="62">termLen</name></expr>, <expr PREFIX:line="105" PREFIX:column="71">0</expr>}</block></expr>}</block></expr></init></decl>;</decl_stmt>
    <return PREFIX:line="106" PREFIX:column="5">return <expr><call><name PREFIX:line="106" PREFIX:column="12">findMulti</name><argument_list PREFIX:line="106" PREFIX:column="21">(<argument><expr><name PREFIX:line="106" PREFIX:column="22">t</name></expr></argument>, <argument><expr PREFIX:line="106" PREFIX:column="25">2</expr></argument>)</argument_list></call> == 0 ? true : false</expr>;</return>
  }</block></else></if>
}</block></function>


<comment type="line" PREFIX:line="111" PREFIX:column="1">// returns the first valid (long) integer value from the current position.</comment>
<comment type="line" PREFIX:line="112" PREFIX:column="1">// initial characters that are not digits (or the minus sign) are skipped</comment>
<comment type="line" PREFIX:line="113" PREFIX:column="1">// function is terminated by the first character that is not a digit.</comment>
<function><type><name PREFIX:line="114" PREFIX:column="1">long</name></type> <name><name PREFIX:line="114" PREFIX:column="6">Stream</name>::<name PREFIX:line="114" PREFIX:column="14">parseInt</name></name><parameter_list PREFIX:line="114" PREFIX:column="22">()</parameter_list>
<block PREFIX:line="115" PREFIX:column="1">{
  <return PREFIX:line="116" PREFIX:column="3">return <expr><call><name PREFIX:line="116" PREFIX:column="10">parseInt</name><argument_list PREFIX:line="116" PREFIX:column="18">(<argument><expr><name PREFIX:line="116" PREFIX:column="19">NO_SKIP_CHAR</name></expr></argument>)</argument_list></call></expr>;</return> <comment type="line" PREFIX:line="116" PREFIX:column="34">// terminate on first non-digit character (or timeout)</comment>
}</block></function>

<comment type="line" PREFIX:line="119" PREFIX:column="1">// as above but a given skipChar is ignored</comment>
<comment type="line" PREFIX:line="120" PREFIX:column="1">// this allows format characters (typically commas) in values to be ignored</comment>
<function><type><name PREFIX:line="121" PREFIX:column="1">long</name></type> <name><name PREFIX:line="121" PREFIX:column="6">Stream</name>::<name PREFIX:line="121" PREFIX:column="14">parseInt</name></name><parameter_list PREFIX:line="121" PREFIX:column="22">(<param><decl><type><name PREFIX:line="121" PREFIX:column="23">char</name></type> <name PREFIX:line="121" PREFIX:column="28">skipChar</name></decl></param>)</parameter_list>
<block PREFIX:line="122" PREFIX:column="1">{
  <decl_stmt><decl><type><name PREFIX:line="123" PREFIX:column="3">bool</name></type> <name PREFIX:line="123" PREFIX:column="8">isNegative</name> <init PREFIX:line="123" PREFIX:column="19">= <expr PREFIX:line="123" PREFIX:column="21">false</expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><name PREFIX:line="124" PREFIX:column="3">long</name></type> <name PREFIX:line="124" PREFIX:column="8">value</name> <init PREFIX:line="124" PREFIX:column="14">= <expr PREFIX:line="124" PREFIX:column="16">0</expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><name PREFIX:line="125" PREFIX:column="3">int</name></type> <name PREFIX:line="125" PREFIX:column="7">c</name></decl>;</decl_stmt>

  <expr_stmt><expr><name PREFIX:line="127" PREFIX:column="3">c</name> = <call><name PREFIX:line="127" PREFIX:column="7">peekNextDigit</name><argument_list PREFIX:line="127" PREFIX:column="20">()</argument_list></call></expr>;</expr_stmt>
  <comment type="line" PREFIX:line="128" PREFIX:column="3">// ignore non numeric leading characters</comment>
  <if PREFIX:line="129" PREFIX:column="3">if<condition PREFIX:line="129" PREFIX:column="5">(<expr><name PREFIX:line="129" PREFIX:column="6">c</name> &lt; 0</expr>)</condition><then PREFIX:line="129" PREFIX:column="12">
    <return PREFIX:line="130" PREFIX:column="5">return <expr PREFIX:line="130" PREFIX:column="12">0</expr>;</return></then></if> <comment type="line" PREFIX:line="130" PREFIX:column="15">// zero returned if timeout</comment>

  <do PREFIX:line="132" PREFIX:column="3">do<block PREFIX:line="132" PREFIX:column="5">{
    <if PREFIX:line="133" PREFIX:column="5">if<condition PREFIX:line="133" PREFIX:column="7">(<expr><name PREFIX:line="133" PREFIX:column="8">c</name> == <name PREFIX:line="133" PREFIX:column="13">skipChar</name></expr>)</condition><then PREFIX:line="133" PREFIX:column="22">
      <empty_stmt PREFIX:line="134" PREFIX:column="7">;</empty_stmt></then> <comment type="line" PREFIX:line="134" PREFIX:column="9">// ignore this charactor</comment>
    <else PREFIX:line="135" PREFIX:column="5">else <if PREFIX:line="135" PREFIX:column="10">if<condition PREFIX:line="135" PREFIX:column="12">(<expr><name PREFIX:line="135" PREFIX:column="13">c</name> == '-'</expr>)</condition><then PREFIX:line="135" PREFIX:column="22">
      <expr_stmt><expr><name PREFIX:line="136" PREFIX:column="7">isNegative</name> = true</expr>;</expr_stmt></then>
    <else PREFIX:line="137" PREFIX:column="5">else <if PREFIX:line="137" PREFIX:column="10">if<condition PREFIX:line="137" PREFIX:column="12">(<expr><name PREFIX:line="137" PREFIX:column="13">c</name> &gt;= '0' &amp;&amp; <name PREFIX:line="137" PREFIX:column="25">c</name> &lt;= '9'</expr>)</condition><then PREFIX:line="137" PREFIX:column="34">        <comment type="line" PREFIX:line="137" PREFIX:column="42">// is c a digit?</comment>
      <expr_stmt><expr><name PREFIX:line="138" PREFIX:column="7">value</name> = <name PREFIX:line="138" PREFIX:column="15">value</name> * 10 + <name PREFIX:line="138" PREFIX:column="28">c</name> - '0'</expr>;</expr_stmt></then></if></else></if></else></if>
    <expr_stmt><expr><call><name PREFIX:line="139" PREFIX:column="5">read</name><argument_list PREFIX:line="139" PREFIX:column="9">()</argument_list></call></expr>;</expr_stmt>  <comment type="line" PREFIX:line="139" PREFIX:column="14">// consume the character we got with peek</comment>
    <expr_stmt><expr><name PREFIX:line="140" PREFIX:column="5">c</name> = <call><name PREFIX:line="140" PREFIX:column="9">timedPeek</name><argument_list PREFIX:line="140" PREFIX:column="18">()</argument_list></call></expr>;</expr_stmt>
  }</block>
  while<condition PREFIX:line="142" PREFIX:column="8">( <expr PREFIX:line="142" PREFIX:column="10">(<name PREFIX:line="142" PREFIX:column="11">c</name> &gt;= '0' &amp;&amp; <name PREFIX:line="142" PREFIX:column="23">c</name> &lt;= '9') || <name PREFIX:line="142" PREFIX:column="36">c</name> == <name PREFIX:line="142" PREFIX:column="41">skipChar</name></expr> )</condition>;</do>

  <if PREFIX:line="144" PREFIX:column="3">if<condition PREFIX:line="144" PREFIX:column="5">(<expr><name PREFIX:line="144" PREFIX:column="6">isNegative</name></expr>)</condition><then PREFIX:line="144" PREFIX:column="17">
    <expr_stmt><expr><name PREFIX:line="145" PREFIX:column="5">value</name> = -<name PREFIX:line="145" PREFIX:column="14">value</name></expr>;</expr_stmt></then></if>
  <return PREFIX:line="146" PREFIX:column="3">return <expr><name PREFIX:line="146" PREFIX:column="10">value</name></expr>;</return>
}</block></function>


<comment type="line" PREFIX:line="150" PREFIX:column="1">// as parseInt but returns a floating point value</comment>
<function><type><name PREFIX:line="151" PREFIX:column="1">float</name></type> <name><name PREFIX:line="151" PREFIX:column="7">Stream</name>::<name PREFIX:line="151" PREFIX:column="15">parseFloat</name></name><parameter_list PREFIX:line="151" PREFIX:column="25">()</parameter_list>
<block PREFIX:line="152" PREFIX:column="1">{
  <return PREFIX:line="153" PREFIX:column="3">return <expr><call><name PREFIX:line="153" PREFIX:column="10">parseFloat</name><argument_list PREFIX:line="153" PREFIX:column="20">(<argument><expr><name PREFIX:line="153" PREFIX:column="21">NO_SKIP_CHAR</name></expr></argument>)</argument_list></call></expr>;</return>
}</block></function>

<comment type="line" PREFIX:line="156" PREFIX:column="1">// as above but the given skipChar is ignored</comment>
<comment type="line" PREFIX:line="157" PREFIX:column="1">// this allows format characters (typically commas) in values to be ignored</comment>
<function><type><name PREFIX:line="158" PREFIX:column="1">float</name></type> <name><name PREFIX:line="158" PREFIX:column="7">Stream</name>::<name PREFIX:line="158" PREFIX:column="15">parseFloat</name></name><parameter_list PREFIX:line="158" PREFIX:column="25">(<param><decl><type><name PREFIX:line="158" PREFIX:column="26">char</name></type> <name PREFIX:line="158" PREFIX:column="31">skipChar</name></decl></param>)</parameter_list><block PREFIX:line="158" PREFIX:column="40">{
  <decl_stmt><decl><type><name PREFIX:line="159" PREFIX:column="3">bool</name></type> <name PREFIX:line="159" PREFIX:column="8">isNegative</name> <init PREFIX:line="159" PREFIX:column="19">= <expr PREFIX:line="159" PREFIX:column="21">false</expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><name PREFIX:line="160" PREFIX:column="3">bool</name></type> <name PREFIX:line="160" PREFIX:column="8">isFraction</name> <init PREFIX:line="160" PREFIX:column="19">= <expr PREFIX:line="160" PREFIX:column="21">false</expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><name PREFIX:line="161" PREFIX:column="3">long</name></type> <name PREFIX:line="161" PREFIX:column="8">value</name> <init PREFIX:line="161" PREFIX:column="14">= <expr PREFIX:line="161" PREFIX:column="16">0</expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><name PREFIX:line="162" PREFIX:column="3">char</name></type> <name PREFIX:line="162" PREFIX:column="8">c</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><name PREFIX:line="163" PREFIX:column="3">float</name></type> <name PREFIX:line="163" PREFIX:column="9">fraction</name> <init PREFIX:line="163" PREFIX:column="18">= <expr PREFIX:line="163" PREFIX:column="20">1.0</expr></init></decl>;</decl_stmt>

  <expr_stmt><expr><name PREFIX:line="165" PREFIX:column="3">c</name> = <call><name PREFIX:line="165" PREFIX:column="7">peekNextDigit</name><argument_list PREFIX:line="165" PREFIX:column="20">()</argument_list></call></expr>;</expr_stmt>
    <comment type="line" PREFIX:line="166" PREFIX:column="5">// ignore non numeric leading characters</comment>
  <if PREFIX:line="167" PREFIX:column="3">if<condition PREFIX:line="167" PREFIX:column="5">(<expr><name PREFIX:line="167" PREFIX:column="6">c</name> &lt; 0</expr>)</condition><then PREFIX:line="167" PREFIX:column="12">
    <return PREFIX:line="168" PREFIX:column="5">return <expr PREFIX:line="168" PREFIX:column="12">0</expr>;</return></then></if> <comment type="line" PREFIX:line="168" PREFIX:column="15">// zero returned if timeout</comment>

  <do PREFIX:line="170" PREFIX:column="3">do<block PREFIX:line="170" PREFIX:column="5">{
    <if PREFIX:line="171" PREFIX:column="5">if<condition PREFIX:line="171" PREFIX:column="7">(<expr><name PREFIX:line="171" PREFIX:column="8">c</name> == <name PREFIX:line="171" PREFIX:column="13">skipChar</name></expr>)</condition><then PREFIX:line="171" PREFIX:column="22">
      <empty_stmt PREFIX:line="172" PREFIX:column="7">;</empty_stmt></then> <comment type="line" PREFIX:line="172" PREFIX:column="9">// ignore</comment>
    <else PREFIX:line="173" PREFIX:column="5">else <if PREFIX:line="173" PREFIX:column="10">if<condition PREFIX:line="173" PREFIX:column="12">(<expr><name PREFIX:line="173" PREFIX:column="13">c</name> == '-'</expr>)</condition><then PREFIX:line="173" PREFIX:column="22">
      <expr_stmt><expr><name PREFIX:line="174" PREFIX:column="7">isNegative</name> = true</expr>;</expr_stmt></then>
    <else PREFIX:line="175" PREFIX:column="5">else <if PREFIX:line="175" PREFIX:column="10">if <condition PREFIX:line="175" PREFIX:column="13">(<expr><name PREFIX:line="175" PREFIX:column="14">c</name> == '.'</expr>)</condition><then PREFIX:line="175" PREFIX:column="23">
      <expr_stmt><expr><name PREFIX:line="176" PREFIX:column="7">isFraction</name> = true</expr>;</expr_stmt></then>
    <else PREFIX:line="177" PREFIX:column="5">else <if PREFIX:line="177" PREFIX:column="10">if<condition PREFIX:line="177" PREFIX:column="12">(<expr><name PREFIX:line="177" PREFIX:column="13">c</name> &gt;= '0' &amp;&amp; <name PREFIX:line="177" PREFIX:column="25">c</name> &lt;= '9'</expr>)</condition><then PREFIX:line="177" PREFIX:column="34">  <block PREFIX:line="177" PREFIX:column="36">{      <comment type="line" PREFIX:line="177" PREFIX:column="43">// is c a digit?</comment>
      <expr_stmt><expr><name PREFIX:line="178" PREFIX:column="7">value</name> = <name PREFIX:line="178" PREFIX:column="15">value</name> * 10 + <name PREFIX:line="178" PREFIX:column="28">c</name> - '0'</expr>;</expr_stmt>
      <if PREFIX:line="179" PREFIX:column="7">if<condition PREFIX:line="179" PREFIX:column="9">(<expr><name PREFIX:line="179" PREFIX:column="10">isFraction</name></expr>)</condition><then PREFIX:line="179" PREFIX:column="21">
         <expr_stmt><expr><name PREFIX:line="180" PREFIX:column="10">fraction</name> *= 0.1</expr>;</expr_stmt></then></if>
    }</block></then></if></else></if></else></if></else></if>
    <expr_stmt><expr><call><name PREFIX:line="182" PREFIX:column="5">read</name><argument_list PREFIX:line="182" PREFIX:column="9">()</argument_list></call></expr>;</expr_stmt>  <comment type="line" PREFIX:line="182" PREFIX:column="14">// consume the character we got with peek</comment>
    <expr_stmt><expr><name PREFIX:line="183" PREFIX:column="5">c</name> = <call><name PREFIX:line="183" PREFIX:column="9">timedPeek</name><argument_list PREFIX:line="183" PREFIX:column="18">()</argument_list></call></expr>;</expr_stmt>
  }</block>
  while<condition PREFIX:line="185" PREFIX:column="8">( <expr PREFIX:line="185" PREFIX:column="10">(<name PREFIX:line="185" PREFIX:column="11">c</name> &gt;= '0' &amp;&amp; <name PREFIX:line="185" PREFIX:column="23">c</name> &lt;= '9')  || <name PREFIX:line="185" PREFIX:column="37">c</name> == '.' || <name PREFIX:line="185" PREFIX:column="49">c</name> == <name PREFIX:line="185" PREFIX:column="54">skipChar</name></expr> )</condition>;</do>

  <if PREFIX:line="187" PREFIX:column="3">if<condition PREFIX:line="187" PREFIX:column="5">(<expr><name PREFIX:line="187" PREFIX:column="6">isNegative</name></expr>)</condition><then PREFIX:line="187" PREFIX:column="17">
    <expr_stmt><expr><name PREFIX:line="188" PREFIX:column="5">value</name> = -<name PREFIX:line="188" PREFIX:column="14">value</name></expr>;</expr_stmt></then></if>
  <if PREFIX:line="189" PREFIX:column="3">if<condition PREFIX:line="189" PREFIX:column="5">(<expr><name PREFIX:line="189" PREFIX:column="6">isFraction</name></expr>)</condition><then PREFIX:line="189" PREFIX:column="17">
    <return PREFIX:line="190" PREFIX:column="5">return <expr><name PREFIX:line="190" PREFIX:column="12">value</name> * <name PREFIX:line="190" PREFIX:column="20">fraction</name></expr>;</return></then>
  <else PREFIX:line="191" PREFIX:column="3">else
    <return PREFIX:line="192" PREFIX:column="5">return <expr><name PREFIX:line="192" PREFIX:column="12">value</name></expr>;</return></else></if>
}</block></function>

<comment type="line" PREFIX:line="195" PREFIX:column="1">// read characters from stream into buffer</comment>
<comment type="line" PREFIX:line="196" PREFIX:column="1">// terminates if length characters have been read, or timeout (see setTimeout)</comment>
<comment type="line" PREFIX:line="197" PREFIX:column="1">// returns the number of characters placed in the buffer</comment>
<comment type="line" PREFIX:line="198" PREFIX:column="1">// the buffer is NOT null terminated.</comment>
<comment type="line" PREFIX:line="199" PREFIX:column="1">//</comment>
<function><type><name PREFIX:line="200" PREFIX:column="1">size_t</name></type> <name><name PREFIX:line="200" PREFIX:column="8">Stream</name>::<name PREFIX:line="200" PREFIX:column="16">readBytes</name></name><parameter_list PREFIX:line="200" PREFIX:column="25">(<param><decl><type><name PREFIX:line="200" PREFIX:column="26">char</name> *</type><name PREFIX:line="200" PREFIX:column="32">buffer</name></decl></param>, <param><decl><type><name PREFIX:line="200" PREFIX:column="40">size_t</name></type> <name PREFIX:line="200" PREFIX:column="47">length</name></decl></param>)</parameter_list>
<block PREFIX:line="201" PREFIX:column="1">{
  <decl_stmt><decl><type><name PREFIX:line="202" PREFIX:column="3">size_t</name></type> <name PREFIX:line="202" PREFIX:column="10">count</name> <init PREFIX:line="202" PREFIX:column="16">= <expr PREFIX:line="202" PREFIX:column="18">0</expr></init></decl>;</decl_stmt>
  <while PREFIX:line="203" PREFIX:column="3">while <condition PREFIX:line="203" PREFIX:column="9">(<expr><name PREFIX:line="203" PREFIX:column="10">count</name> &lt; <name PREFIX:line="203" PREFIX:column="18">length</name></expr>)</condition> <block PREFIX:line="203" PREFIX:column="26">{
    <decl_stmt><decl><type><name PREFIX:line="204" PREFIX:column="5">int</name></type> <name PREFIX:line="204" PREFIX:column="9">c</name> <init PREFIX:line="204" PREFIX:column="11">= <expr><call><name PREFIX:line="204" PREFIX:column="13">timedRead</name><argument_list PREFIX:line="204" PREFIX:column="22">()</argument_list></call></expr></init></decl>;</decl_stmt>
    <if PREFIX:line="205" PREFIX:column="5">if <condition PREFIX:line="205" PREFIX:column="8">(<expr><name PREFIX:line="205" PREFIX:column="9">c</name> &lt; 0</expr>)</condition><then PREFIX:line="205" PREFIX:column="15"> <break PREFIX:line="205" PREFIX:column="16">break;</break></then></if>
    <expr_stmt><expr PREFIX:line="206" PREFIX:column="5">*<name PREFIX:line="206" PREFIX:column="6">buffer</name>++ = (<name PREFIX:line="206" PREFIX:column="18">char</name>)<name PREFIX:line="206" PREFIX:column="23">c</name></expr>;</expr_stmt>
    <expr_stmt><expr><name PREFIX:line="207" PREFIX:column="5">count</name>++</expr>;</expr_stmt>
  }</block></while>
  <return PREFIX:line="209" PREFIX:column="3">return <expr><name PREFIX:line="209" PREFIX:column="10">count</name></expr>;</return>
}</block></function>


<comment type="line" PREFIX:line="213" PREFIX:column="1">// as readBytes with terminator character</comment>
<comment type="line" PREFIX:line="214" PREFIX:column="1">// terminates if length characters have been read, timeout, or if the terminator character  detected</comment>
<comment type="line" PREFIX:line="215" PREFIX:column="1">// returns the number of characters placed in the buffer (0 means no valid data found)</comment>

<function><type><name PREFIX:line="217" PREFIX:column="1">size_t</name></type> <name><name PREFIX:line="217" PREFIX:column="8">Stream</name>::<name PREFIX:line="217" PREFIX:column="16">readBytesUntil</name></name><parameter_list PREFIX:line="217" PREFIX:column="30">(<param><decl><type><name PREFIX:line="217" PREFIX:column="31">char</name></type> <name PREFIX:line="217" PREFIX:column="36">terminator</name></decl></param>, <param><decl><type><name PREFIX:line="217" PREFIX:column="48">char</name> *</type><name PREFIX:line="217" PREFIX:column="54">buffer</name></decl></param>, <param><decl><type><name PREFIX:line="217" PREFIX:column="62">size_t</name></type> <name PREFIX:line="217" PREFIX:column="69">length</name></decl></param>)</parameter_list>
<block PREFIX:line="218" PREFIX:column="1">{
  <if PREFIX:line="219" PREFIX:column="3">if <condition PREFIX:line="219" PREFIX:column="6">(<expr><name PREFIX:line="219" PREFIX:column="7">length</name> &lt; 1</expr>)</condition><then PREFIX:line="219" PREFIX:column="18"> <return PREFIX:line="219" PREFIX:column="19">return <expr PREFIX:line="219" PREFIX:column="26">0</expr>;</return></then></if>
  <decl_stmt><decl><type><name PREFIX:line="220" PREFIX:column="3">size_t</name></type> <name PREFIX:line="220" PREFIX:column="10">index</name> <init PREFIX:line="220" PREFIX:column="16">= <expr PREFIX:line="220" PREFIX:column="18">0</expr></init></decl>;</decl_stmt>
  <while PREFIX:line="221" PREFIX:column="3">while <condition PREFIX:line="221" PREFIX:column="9">(<expr><name PREFIX:line="221" PREFIX:column="10">index</name> &lt; <name PREFIX:line="221" PREFIX:column="18">length</name></expr>)</condition> <block PREFIX:line="221" PREFIX:column="26">{
    <decl_stmt><decl><type><name PREFIX:line="222" PREFIX:column="5">int</name></type> <name PREFIX:line="222" PREFIX:column="9">c</name> <init PREFIX:line="222" PREFIX:column="11">= <expr><call><name PREFIX:line="222" PREFIX:column="13">timedRead</name><argument_list PREFIX:line="222" PREFIX:column="22">()</argument_list></call></expr></init></decl>;</decl_stmt>
    <if PREFIX:line="223" PREFIX:column="5">if <condition PREFIX:line="223" PREFIX:column="8">(<expr><name PREFIX:line="223" PREFIX:column="9">c</name> &lt; 0 || <name PREFIX:line="223" PREFIX:column="18">c</name> == <name PREFIX:line="223" PREFIX:column="23">terminator</name></expr>)</condition><then PREFIX:line="223" PREFIX:column="34"> <break PREFIX:line="223" PREFIX:column="35">break;</break></then></if>
    <expr_stmt><expr PREFIX:line="224" PREFIX:column="5">*<name PREFIX:line="224" PREFIX:column="6">buffer</name>++ = (<name PREFIX:line="224" PREFIX:column="18">char</name>)<name PREFIX:line="224" PREFIX:column="23">c</name></expr>;</expr_stmt>
    <expr_stmt><expr><name PREFIX:line="225" PREFIX:column="5">index</name>++</expr>;</expr_stmt>
  }</block></while>
  <return PREFIX:line="227" PREFIX:column="3">return <expr><name PREFIX:line="227" PREFIX:column="10">index</name></expr>;</return> <comment type="line" PREFIX:line="227" PREFIX:column="17">// return number of characters, not including null terminator</comment>
}</block></function>

<function><type><name PREFIX:line="230" PREFIX:column="1">String</name></type> <name><name PREFIX:line="230" PREFIX:column="8">Stream</name>::<name PREFIX:line="230" PREFIX:column="16">readString</name></name><parameter_list PREFIX:line="230" PREFIX:column="26">()</parameter_list>
<block PREFIX:line="231" PREFIX:column="1">{
  <decl_stmt><decl><type><name PREFIX:line="232" PREFIX:column="3">String</name></type> <name PREFIX:line="232" PREFIX:column="10">ret</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><name PREFIX:line="233" PREFIX:column="3">int</name></type> <name PREFIX:line="233" PREFIX:column="7">c</name> <init PREFIX:line="233" PREFIX:column="9">= <expr><call><name PREFIX:line="233" PREFIX:column="11">timedRead</name><argument_list PREFIX:line="233" PREFIX:column="20">()</argument_list></call></expr></init></decl>;</decl_stmt>
  <while PREFIX:line="234" PREFIX:column="3">while <condition PREFIX:line="234" PREFIX:column="9">(<expr><name PREFIX:line="234" PREFIX:column="10">c</name> &gt;= 0</expr>)</condition>
  <block PREFIX:line="235" PREFIX:column="3">{
    <expr_stmt><expr><name PREFIX:line="236" PREFIX:column="5">ret</name> += (<name PREFIX:line="236" PREFIX:column="13">char</name>)<name PREFIX:line="236" PREFIX:column="18">c</name></expr>;</expr_stmt>
    <expr_stmt><expr><name PREFIX:line="237" PREFIX:column="5">c</name> = <call><name PREFIX:line="237" PREFIX:column="9">timedRead</name><argument_list PREFIX:line="237" PREFIX:column="18">()</argument_list></call></expr>;</expr_stmt>
  }</block></while>
  <return PREFIX:line="239" PREFIX:column="3">return <expr><name PREFIX:line="239" PREFIX:column="10">ret</name></expr>;</return>
}</block></function>

<function><type><name PREFIX:line="242" PREFIX:column="1">String</name></type> <name><name PREFIX:line="242" PREFIX:column="8">Stream</name>::<name PREFIX:line="242" PREFIX:column="16">readStringUntil</name></name><parameter_list PREFIX:line="242" PREFIX:column="31">(<param><decl><type><name PREFIX:line="242" PREFIX:column="32">char</name></type> <name PREFIX:line="242" PREFIX:column="37">terminator</name></decl></param>)</parameter_list>
<block PREFIX:line="243" PREFIX:column="1">{
  <decl_stmt><decl><type><name PREFIX:line="244" PREFIX:column="3">String</name></type> <name PREFIX:line="244" PREFIX:column="10">ret</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><name PREFIX:line="245" PREFIX:column="3">int</name></type> <name PREFIX:line="245" PREFIX:column="7">c</name> <init PREFIX:line="245" PREFIX:column="9">= <expr><call><name PREFIX:line="245" PREFIX:column="11">timedRead</name><argument_list PREFIX:line="245" PREFIX:column="20">()</argument_list></call></expr></init></decl>;</decl_stmt>
  <while PREFIX:line="246" PREFIX:column="3">while <condition PREFIX:line="246" PREFIX:column="9">(<expr><name PREFIX:line="246" PREFIX:column="10">c</name> &gt;= 0 &amp;&amp; <name PREFIX:line="246" PREFIX:column="20">c</name> != <name PREFIX:line="246" PREFIX:column="25">terminator</name></expr>)</condition>
  <block PREFIX:line="247" PREFIX:column="3">{
    <expr_stmt><expr><name PREFIX:line="248" PREFIX:column="5">ret</name> += (<name PREFIX:line="248" PREFIX:column="13">char</name>)<name PREFIX:line="248" PREFIX:column="18">c</name></expr>;</expr_stmt>
    <expr_stmt><expr><name PREFIX:line="249" PREFIX:column="5">c</name> = <call><name PREFIX:line="249" PREFIX:column="9">timedRead</name><argument_list PREFIX:line="249" PREFIX:column="18">()</argument_list></call></expr>;</expr_stmt>
  }</block></while>
  <return PREFIX:line="251" PREFIX:column="3">return <expr><name PREFIX:line="251" PREFIX:column="10">ret</name></expr>;</return>
}</block></function>

<decl_stmt><decl><type><name PREFIX:line="254" PREFIX:column="1">int</name></type> <name><name PREFIX:line="254" PREFIX:column="5">Stream</name>::<name PREFIX:line="254" PREFIX:column="13">findMulti</name></name><argument_list PREFIX:line="254" PREFIX:column="22">( <argument PREFIX:line="254" PREFIX:column="24">struct <expr><name><name PREFIX:line="254" PREFIX:column="31">Stream</name>::<name PREFIX:line="254" PREFIX:column="39">MultiTarget</name></name> *<name PREFIX:line="254" PREFIX:column="52">targets</name></expr></argument>, <argument><expr><name PREFIX:line="254" PREFIX:column="61">int</name> <name PREFIX:line="254" PREFIX:column="65">tCount</name></expr></argument>)</argument_list> <argument_list PREFIX:line="254" PREFIX:column="73">{
  <comment type="line" PREFIX:line="255" PREFIX:column="3">// any zero length target string automatically matches and would make</comment>
  <comment type="line" PREFIX:line="256" PREFIX:column="3">// a mess of the rest of the algorithm.</comment>
  for <argument><expr PREFIX:line="257" PREFIX:column="7">(struct <name PREFIX:line="257" PREFIX:column="15">MultiTarget</name> *<name PREFIX:line="257" PREFIX:column="28">t</name> = <name PREFIX:line="257" PREFIX:column="32">targets</name>; <name PREFIX:line="257" PREFIX:column="41">t</name> &lt; <name PREFIX:line="257" PREFIX:column="45">targets</name>+<name PREFIX:line="257" PREFIX:column="53">tCount</name>; ++<name PREFIX:line="257" PREFIX:column="63">t</name>) <block PREFIX:line="257" PREFIX:column="66">{
    <if PREFIX:line="258" PREFIX:column="5">if <condition PREFIX:line="258" PREFIX:column="8">(<expr><name><name PREFIX:line="258" PREFIX:column="9">t</name>-&gt;<name PREFIX:line="258" PREFIX:column="12">len</name></name> &lt;= 0</expr>)</condition><then PREFIX:line="258" PREFIX:column="21">
      <return PREFIX:line="259" PREFIX:column="7">return <expr><name PREFIX:line="259" PREFIX:column="14">t</name> - <name PREFIX:line="259" PREFIX:column="18">targets</name></expr>;</return></then></if>
  }</block></expr></argument>

  <while PREFIX:line="262" PREFIX:column="3">while <condition PREFIX:line="262" PREFIX:column="9">(<expr PREFIX:line="262" PREFIX:column="10">1</expr>)</condition> <expr_stmt><expr><block PREFIX:line="262" PREFIX:column="13">{
    <expr><name PREFIX:line="263" PREFIX:column="5">int</name> <name PREFIX:line="263" PREFIX:column="9">c</name> = <call><name PREFIX:line="263" PREFIX:column="13">timedRead</name><argument_list PREFIX:line="263" PREFIX:column="22">()</argument_list></call></expr>;
    <if PREFIX:line="264" PREFIX:column="5">if <condition PREFIX:line="264" PREFIX:column="8">(<expr><name PREFIX:line="264" PREFIX:column="9">c</name> &lt; 0</expr>)</condition><then PREFIX:line="264" PREFIX:column="15">
      <return PREFIX:line="265" PREFIX:column="7">return <expr PREFIX:line="265" PREFIX:column="14">-1</expr>;</return></then></if></block></expr></expr_stmt></while></argument_list></decl></decl_stmt>

    <for PREFIX:line="267" PREFIX:column="5">for (<init PREFIX:line="267" PREFIX:column="10">struct <expr><name PREFIX:line="267" PREFIX:column="17">MultiTarget</name> *<name PREFIX:line="267" PREFIX:column="30">t</name> = <name PREFIX:line="267" PREFIX:column="34">targets</name></expr>;</init> <condition><expr><name PREFIX:line="267" PREFIX:column="43">t</name> &lt; <name PREFIX:line="267" PREFIX:column="47">targets</name>+<name PREFIX:line="267" PREFIX:column="55">tCount</name></expr>;</condition> <incr><expr PREFIX:line="267" PREFIX:column="63">++<name PREFIX:line="267" PREFIX:column="65">t</name></expr></incr>) <block PREFIX:line="267" PREFIX:column="68">{
      <comment type="line" PREFIX:line="268" PREFIX:column="7">// the simple case is if we match, deal with that first.</comment>
      <if PREFIX:line="269" PREFIX:column="7">if <condition PREFIX:line="269" PREFIX:column="10">(<expr><name PREFIX:line="269" PREFIX:column="11">c</name> == <name><name PREFIX:line="269" PREFIX:column="16">t</name>-&gt;<name PREFIX:line="269" PREFIX:column="19">str</name><index PREFIX:line="269" PREFIX:column="22">[<expr><name><name PREFIX:line="269" PREFIX:column="23">t</name>-&gt;<name PREFIX:line="269" PREFIX:column="26">index</name></name></expr>]</index></name></expr>)</condition><then PREFIX:line="269" PREFIX:column="33"> <block PREFIX:line="269" PREFIX:column="34">{
        <if PREFIX:line="270" PREFIX:column="9">if <condition PREFIX:line="270" PREFIX:column="12">(<expr PREFIX:line="270" PREFIX:column="13">++<name><name PREFIX:line="270" PREFIX:column="15">t</name>-&gt;<name PREFIX:line="270" PREFIX:column="18">index</name></name> == <name><name PREFIX:line="270" PREFIX:column="27">t</name>-&gt;<name PREFIX:line="270" PREFIX:column="30">len</name></name></expr>)</condition><then PREFIX:line="270" PREFIX:column="34">
          <return PREFIX:line="271" PREFIX:column="11">return <expr><name PREFIX:line="271" PREFIX:column="18">t</name> - <name PREFIX:line="271" PREFIX:column="22">targets</name></expr>;</return></then>
        <else PREFIX:line="272" PREFIX:column="9">else
          <continue PREFIX:line="273" PREFIX:column="11">continue;</continue></else></if>
      }</block></then></if>

      <comment type="line" PREFIX:line="276" PREFIX:column="7">// if not we need to walk back and see if we could have matched further</comment>
      <comment type="line" PREFIX:line="277" PREFIX:column="7">// down the stream (ie '1112' doesn't match the first position in '11112'</comment>
      <comment type="line" PREFIX:line="278" PREFIX:column="7">// but it will match the second position so we can't just reset the current</comment>
      <comment type="line" PREFIX:line="279" PREFIX:column="7">// index to 0 when we find a mismatch.</comment>
      <if PREFIX:line="280" PREFIX:column="7">if <condition PREFIX:line="280" PREFIX:column="10">(<expr><name><name PREFIX:line="280" PREFIX:column="11">t</name>-&gt;<name PREFIX:line="280" PREFIX:column="14">index</name></name> == 0</expr>)</condition><then PREFIX:line="280" PREFIX:column="25">
        <continue PREFIX:line="281" PREFIX:column="9">continue;</continue></then></if>

      <decl_stmt><decl><type><name PREFIX:line="283" PREFIX:column="7">int</name></type> <name PREFIX:line="283" PREFIX:column="11">origIndex</name> <init PREFIX:line="283" PREFIX:column="21">= <expr><name><name PREFIX:line="283" PREFIX:column="23">t</name>-&gt;<name PREFIX:line="283" PREFIX:column="26">index</name></name></expr></init></decl>;</decl_stmt>
      <do PREFIX:line="284" PREFIX:column="7">do <block PREFIX:line="284" PREFIX:column="10">{
        <expr_stmt><expr PREFIX:line="285" PREFIX:column="9">--<name><name PREFIX:line="285" PREFIX:column="11">t</name>-&gt;<name PREFIX:line="285" PREFIX:column="14">index</name></name></expr>;</expr_stmt>
        <comment type="line" PREFIX:line="286" PREFIX:column="9">// first check if current char works against the new current index</comment>
        <if PREFIX:line="287" PREFIX:column="9">if <condition PREFIX:line="287" PREFIX:column="12">(<expr><name PREFIX:line="287" PREFIX:column="13">c</name> != <name><name PREFIX:line="287" PREFIX:column="18">t</name>-&gt;<name PREFIX:line="287" PREFIX:column="21">str</name><index PREFIX:line="287" PREFIX:column="24">[<expr><name><name PREFIX:line="287" PREFIX:column="25">t</name>-&gt;<name PREFIX:line="287" PREFIX:column="28">index</name></name></expr>]</index></name></expr>)</condition><then PREFIX:line="287" PREFIX:column="35">
          <continue PREFIX:line="288" PREFIX:column="11">continue;</continue></then></if>

        <comment type="line" PREFIX:line="290" PREFIX:column="9">// if it's the only char then we're good, nothing more to check</comment>
        <if PREFIX:line="291" PREFIX:column="9">if <condition PREFIX:line="291" PREFIX:column="12">(<expr><name><name PREFIX:line="291" PREFIX:column="13">t</name>-&gt;<name PREFIX:line="291" PREFIX:column="16">index</name></name> == 0</expr>)</condition><then PREFIX:line="291" PREFIX:column="27"> <block PREFIX:line="291" PREFIX:column="28">{
          <expr_stmt><expr><name><name PREFIX:line="292" PREFIX:column="11">t</name>-&gt;<name PREFIX:line="292" PREFIX:column="14">index</name></name>++</expr>;</expr_stmt>
          <break PREFIX:line="293" PREFIX:column="11">break;</break>
        }</block></then></if>

        <comment type="line" PREFIX:line="296" PREFIX:column="9">// otherwise we need to check the rest of the found string</comment>
        <decl_stmt><decl><type><name PREFIX:line="297" PREFIX:column="9">int</name></type> <name PREFIX:line="297" PREFIX:column="13">diff</name> <init PREFIX:line="297" PREFIX:column="18">= <expr><name PREFIX:line="297" PREFIX:column="20">origIndex</name> - <name><name PREFIX:line="297" PREFIX:column="32">t</name>-&gt;<name PREFIX:line="297" PREFIX:column="35">index</name></name></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name PREFIX:line="298" PREFIX:column="9">size_t</name></type> <name PREFIX:line="298" PREFIX:column="16">i</name></decl>;</decl_stmt>
        <for PREFIX:line="299" PREFIX:column="9">for (<init><expr><name PREFIX:line="299" PREFIX:column="14">i</name> = 0</expr>;</init> <condition><expr><name PREFIX:line="299" PREFIX:column="21">i</name> &lt; <name><name PREFIX:line="299" PREFIX:column="25">t</name>-&gt;<name PREFIX:line="299" PREFIX:column="28">index</name></name></expr>;</condition> <incr><expr PREFIX:line="299" PREFIX:column="35">++<name PREFIX:line="299" PREFIX:column="37">i</name></expr></incr>) <block PREFIX:line="299" PREFIX:column="40">{
          <if PREFIX:line="300" PREFIX:column="11">if <condition PREFIX:line="300" PREFIX:column="14">(<expr><name><name PREFIX:line="300" PREFIX:column="15">t</name>-&gt;<name PREFIX:line="300" PREFIX:column="18">str</name><index PREFIX:line="300" PREFIX:column="21">[<expr><name PREFIX:line="300" PREFIX:column="22">i</name></expr>]</index></name> != <name><name PREFIX:line="300" PREFIX:column="28">t</name>-&gt;<name PREFIX:line="300" PREFIX:column="31">str</name><index PREFIX:line="300" PREFIX:column="34">[<expr><name PREFIX:line="300" PREFIX:column="35">i</name> + <name PREFIX:line="300" PREFIX:column="39">diff</name></expr>]</index></name></expr>)</condition><then PREFIX:line="300" PREFIX:column="45">
            <break PREFIX:line="301" PREFIX:column="13">break;</break></then></if>
        }</block></for>

        <comment type="line" PREFIX:line="304" PREFIX:column="9">// if we successfully got through the previous loop then our current</comment>
        <comment type="line" PREFIX:line="305" PREFIX:column="9">// index is good.</comment>
        <if PREFIX:line="306" PREFIX:column="9">if <condition PREFIX:line="306" PREFIX:column="12">(<expr><name PREFIX:line="306" PREFIX:column="13">i</name> == <name><name PREFIX:line="306" PREFIX:column="18">t</name>-&gt;<name PREFIX:line="306" PREFIX:column="21">index</name></name></expr>)</condition><then PREFIX:line="306" PREFIX:column="27"> <block PREFIX:line="306" PREFIX:column="28">{
          <expr_stmt><expr><name><name PREFIX:line="307" PREFIX:column="11">t</name>-&gt;<name PREFIX:line="307" PREFIX:column="14">index</name></name>++</expr>;</expr_stmt>
          <break PREFIX:line="308" PREFIX:column="11">break;</break>
        }</block></then></if>

        <comment type="line" PREFIX:line="311" PREFIX:column="9">// otherwise we just try the next index</comment>
      }</block> while <condition PREFIX:line="312" PREFIX:column="15">(<expr><name><name PREFIX:line="312" PREFIX:column="16">t</name>-&gt;<name PREFIX:line="312" PREFIX:column="19">index</name></name></expr>)</condition>;</do>
    }</block></for>
  }
  <comment type="line" PREFIX:line="315" PREFIX:column="3">// unreachable</comment>
  return <expr_stmt><expr PREFIX:line="316" PREFIX:column="10">-1</expr>;</expr_stmt>
}
</unit>
